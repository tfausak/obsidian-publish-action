(()=>{var e={265:function(e,t,n){"use strict";var o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const s=o(n(87)),r=n(570);function i(e,t,n){const o=new a(e,t,n);process.stdout.write(o.toString()+s.EOL)}t.issueCommand=i,t.issue=function(e,t=""){i(e,{},t)};class a{constructor(e,t,n){e||(e="missing.command"),this.command=e,this.properties=t,this.message=n}toString(){let e="::"+this.command;if(this.properties&&Object.keys(this.properties).length>0){e+=" ";let n=!0;for(const o in this.properties)if(this.properties.hasOwnProperty(o)){const s=this.properties[o];s&&(n?n=!1:e+=",",e+=`${o}=${t=s,r.toCommandValue(t).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}`)}}var t;return e+=`::${function(e){return r.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}(this.message)}`,e}}},225:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(s,r){function i(e){try{u(o.next(e))}catch(e){r(e)}}function a(e){try{u(o.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((o=o.apply(e,t||[])).next())}))},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(265),i=n(108),a=n(570),u=s(n(87)),c=s(n(622));var d;function p(e){r.issue("error",e instanceof Error?e.toString():e)}function f(e){r.issue("group",e)}function l(){r.issue("endgroup")}!function(e){e[e.Success=0]="Success",e[e.Failure=1]="Failure"}(d=t.ExitCode||(t.ExitCode={})),t.exportVariable=function(e,t){const n=a.toCommandValue(t);if(process.env[e]=n,process.env.GITHUB_ENV){const t="_GitHubActionsFileCommandDelimeter_",o=`${e}<<${t}${u.EOL}${n}${u.EOL}${t}`;i.issueCommand("ENV",o)}else r.issueCommand("set-env",{name:e},n)},t.setSecret=function(e){r.issueCommand("add-mask",{},e)},t.addPath=function(e){process.env.GITHUB_PATH?i.issueCommand("PATH",e):r.issueCommand("add-path",{},e),process.env.PATH=`${e}${c.delimiter}${process.env.PATH}`},t.getInput=function(e,t){const n=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!n)throw new Error(`Input required and not supplied: ${e}`);return n.trim()},t.setOutput=function(e,t){process.stdout.write(u.EOL),r.issueCommand("set-output",{name:e},t)},t.setCommandEcho=function(e){r.issue("echo",e?"on":"off")},t.setFailed=function(e){process.exitCode=d.Failure,p(e)},t.isDebug=function(){return"1"===process.env.RUNNER_DEBUG},t.debug=function(e){r.issueCommand("debug",{},e)},t.error=p,t.warning=function(e){r.issue("warning",e instanceof Error?e.toString():e)},t.info=function(e){process.stdout.write(e+u.EOL)},t.startGroup=f,t.endGroup=l,t.group=function(e,t){return o(this,void 0,void 0,(function*(){let n;f(e);try{n=yield t()}finally{l()}return n}))},t.saveState=function(e,t){r.issueCommand("save-state",{name:e},t)},t.getState=function(e){return process.env[`STATE_${e}`]||""}},108:function(e,t,n){"use strict";var o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const s=o(n(747)),r=o(n(87)),i=n(570);t.issueCommand=function(e,t){const n=process.env[`GITHUB_${e}`];if(!n)throw new Error(`Unable to find environment variable for file command ${e}`);if(!s.existsSync(n))throw new Error(`Missing file at path: ${n}`);s.appendFileSync(n,`${i.toCommandValue(t)}${r.EOL}`,{encoding:"utf8"})}},570:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toCommandValue=function(e){return null==e?"":"string"==typeof e||e instanceof String?e:JSON.stringify(e)}},417:e=>{"use strict";e.exports=require("crypto")},747:e=>{"use strict";e.exports=require("fs")},211:e=>{"use strict";e.exports=require("https")},87:e=>{"use strict";e.exports=require("os")},622:e=>{"use strict";e.exports=require("path")}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}(()=>{const e=n(225),t=n(417),o=n(747).promises,s=n(211),r=n(622),i=(e,t,n)=>new Promise(((o,r)=>{const i=s.request(e,t,(e=>{const t=[];e.on("data",(e=>t.push(e))),e.on("end",(()=>o({status:{code:e.statusCode,message:e.statusMessage},headers:e.headers,body:Buffer.concat(t)})))}));i.on("error",(e=>r(e))),i.end(n)})),a=async e=>{const t=new Set,n=await o.readdir(e);for(const s of n){const n=r.posix.join(e,s);(await o.lstat(n)).isDirectory()?(await a(n)).forEach((e=>t.add(e))):t.add(n)}return t},u=(e,t)=>`${e} ${t}${1===e?"":"s"}`,c=async(e,t,n)=>i("https://publish-01.obsidian.md/api/remove",{headers:{"Content-Type":"application/json"},method:"POST"},JSON.stringify({id:e,path:n,token:t})),d=async(e,n,s)=>{const r=await o.readFile(s),a=t.createHash("sha256");return a.update(r),i("https://publish-01.obsidian.md/api/upload",{headers:{"Content-Type":"application/octet-stream","obs-hash":a.digest("hex"),"obs-id":e,"obs-path":s,"obs-token":n},method:"POST"},r)};(async()=>{const n=/^(\.git|\.obsidian|node_modules)/;e.startGroup("Getting inputs");const s=e.getInput("site",{required:!0}),r=e.getInput("token",{required:!0});e.setSecret(r),e.info("Got inputs"),e.endGroup(),e.startGroup("Getting local files");const p=await(async e=>{const n={},s=await a(".");for(const e of s){const s=await o.readFile(e),r=t.createHash("sha256");r.update(s),n[e]=r.digest("hex")}return n})();for(const t of Object.keys(p))t.match(n)&&(e.info(`Ignoring ${t} (${p[t]})`),delete p[t]);e.info(`Got ${u(Object.keys(p).length,"file")}`),e.endGroup(),e.startGroup("Getting remote files");const f=await(async(e,t)=>{const n={},o=await i("https://publish-01.obsidian.md/api/list",{headers:{"Content-Type":"application/json"},method:"POST"},JSON.stringify({id:e,token:t}));for(const e of JSON.parse(o.body.toString()))n[e.path]=e.hash;return n})(s,r);e.info(`Got ${u(Object.keys(f).length,"file")}`),e.endGroup();const l=new Set,m=new Set,h=new Set;for(const e of Object.keys(p))f.hasOwnProperty(e)?p[e]!==f[e]&&m.add(e):l.add(e);for(const e of Object.keys(f))p.hasOwnProperty(e)||h.add(e);e.startGroup("Adding new files"),e.info(`Adding ${u(l.size,"file")}`);for(const t of l){const n=p[t];e.info(`Adding ${t} (${n})`),await d(s,r,t)}e.endGroup(),e.startGroup("Updating existing files"),e.info(`Updating ${u(m.size,"file")}`);for(const t of m){const n=f[t],o=p[t];e.info(`Updating ${t} (${n} -> ${o})`),await d(s,r,t)}e.endGroup(),e.startGroup("Removing old files"),e.info(`Removing ${u(h.size,"file")}`);for(const t of h){const n=f[t];e.info(`Removing ${t} (${n})`),await c(s,r,t)}})().catch((t=>e.setFailed(t)))})()})();